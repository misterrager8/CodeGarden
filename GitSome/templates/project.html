{% extends "base.html" %}
{% import "macros.html" as macros with context %}

{% block body %}
<title>{{ project_.name }}</title>

<ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
        <a class="nav-link active" data-bs-toggle="tab" data-bs-target="#readmeTab" role="tab"><i class="bi bi-code-slash me-2"></i>{{ project_.name }}</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link" data-bs-toggle="tab" data-bs-target="#git" role="tab"><i class="bi bi-git text-danger me-2"></i> Git</a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link" data-bs-toggle="tab" data-bs-target="#kanban" role="tab"><i class="bi bi-kanban text-info me-2"></i> Kanban</a>
    </li>
</ul>
<div class="tab-content p-5">
    <div id="readmeTab" class="tab-pane show active" role="tabpanel">
        <a href="{{ url_for('delete_project', id_=project_.id) }}" class="font-custom text-danger float-end"><i class="bi bi-trash3"></i> Delete</a>
        <a onclick="toggleDiv('editReadme')" class="bi bi-pen me-3"> Edit README</a>
        <a onclick="copyPath()" class="bi bi-clipboard " id="copyIcon"> Copy Path</a>
        <input value="{{ project_.filepath }}" style="display: none" id="copyPath">
        <div class="row mt-3">
            <div class="col" style="white-space: pre-wrap" id="preview">{{ project_.get_readme_as_md() | safe }}</div>
            <div class="col" style="display: none" id="editReadme" class="mt-3">{{ macros.readme_form(project_)}}</div>
        </div>
    </div>
    <div id="git" class="tab-pane" role="tabpanel">
        <div class="mt-3">
            <div class="input-group font-monospace">
                <span class="input-group-text" >git </span>
                <input data-bs-toggle="dropdown" data-bs-target="#gitOptions" class="form-control" id="cmd" autocomplete="off" placeholder="Command" onkeyup="if(event.key === 'Enter'){ gitCommand({{ project_.id }}, 'git ' + $(this).val()); }">
                <div class="dropdown-menu" id="gitOptions">
                    <a class="dropdown-item" onclick="gitCommand({{ project_.id }}, 'git status')">status</a>
                    <a class="dropdown-item" onclick="gitCommand({{ project_.id }}, 'git log')">log</a>
                    <a class="dropdown-item" onclick="gitCommand({{ project_.id }}, 'git branch')">branch</a>
                    <a class="dropdown-item" onclick="gitCommand({{ project_.id }}, 'git diff')">diff</a>
                    <a class="dropdown-item" onclick="gitCommand({{ project_.id }}, 'git help')">help</a>
                    <a class="dropdown-item" onclick="gitCommand({{ project_.id }}, 'git init')">init</a>
                </div>
            </div>
            <div class="mt-3 font-monospace fst-italic">
                <div style="white-space: pre-wrap" id="refreshThis"></div>
            </div>
        </div>
    </div>
    <div id="kanban" class="tab-pane" role="tabpanel">
        <div class="mt-3">{{ macros.add_todo_form(project_) }}</div>
        <div class="row mb-3">
            <div class="col-xl-4">
                <p class="font-custom"><i class="bi bi-circle-fill text-warning"></i> TODO ({{ project_.get_todos(filter_='status = "Todo"').count() }})</p>
                {% for i in project_.get_todos(filter_='status = "Todo"') %}
                {{ macros.todo_card(i) }}
                {% endfor %}
            </div>
            <div class="col-xl-4">
                <p class="font-custom"><i class="bi bi-circle-fill text-primary"></i> DOING ({{ project_.get_todos(filter_='status = "Doing"').count() }})</p>
                {% for i in project_.get_todos(filter_='status = "Doing"') %}
                {{ macros.todo_card(i) }}
                {% endfor %}
            </div>
            <div class="col-xl-4">
                <p class="font-custom"><i class="bi bi-circle-fill text-success"></i> DONE ({{ project_.get_todos(filter_='status = "Done"').count() }})</p>
                {% for i in project_.get_todos(filter_='status = "Done"') %}
                {{ macros.todo_card(i) }}
                {% endfor %}
            </div>
        </div>

        {% if project_.get_todos().count() > 0 %}
        <a class="btn bi bi-file-earmark-arrow-down" onclick="exportTodos({{ project_.id }})" id="exportIcon"> Export TODOs</a>
        {% endif %}
    </div>
</div>
{% endblock %}
